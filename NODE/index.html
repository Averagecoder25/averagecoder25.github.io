<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Encrypted Terminal</title>
  <style>
    body {
      background-color: black;
      color: #00ff00;
      font-family: monospace;
      margin: 0;
      padding: 0;
    }
    #terminal {
      padding: 20px;
      height: 90vh;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    #userInput {
      width: 100%;
      padding: 10px;
      box-sizing: border-box;
      background: black;
      color: #00ff00;
      border: none;
      font-family: monospace;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="terminal"></div>
  <input type="text" id="userInput" placeholder="Type your message..." disabled />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC3tY4jN2h1hFQyC1KvEadKznh0Vm53zJE",
      authDomain: "dnd-terminal.firebaseapp.com",
      databaseURL: "https://dnd-terminal-default-rtdb.firebaseio.com",
      projectId: "dnd-terminal",
      storageBucket: "dnd-terminal.firebasestorage.app",
      messagingSenderId: "884813360457",
      appId: "1:884813360457:web:431d54614702e372497e98"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const chatRef = db.ref("chat");

    const terminal = document.getElementById("terminal");
    const userInput = document.getElementById("userInput");

    // Spooky message
    const message = [
      "Hello… I've been waiting to finally meet you.",
      "So how does it feel to be a hero in your time?",
      "For me, time is but a memory…",
      "And I will be coming for you."
    ];

    // Function to display message like typing
    function typeMessage(lines, index = 0) {
      if (index >= lines.length) {
        userInput.disabled = false;
        userInput.focus();
        return;
      }
      let line = lines[index];
      let i = 0;
      const interval = setInterval(() => {
        terminal.innerHTML += line[i];
        terminal.scrollTop = terminal.scrollHeight;
        i++;
        if (i >= line.length) {
          clearInterval(interval);
          terminal.innerHTML += "\n";
          setTimeout(() => typeMessage(lines, index + 1), 500);
        }
      }, 40);
    }

    typeMessage(message);

    // Send player messages to Firebase
    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        const val = userInput.value.trim();
        if (val) {
          chatRef.push({ from: "PLAYER", text: val });
          terminal.innerHTML += `> ${val}\n`;
          userInput.value = "";
        }
      }
    });

    // Receive DM replies
    chatRef.on("child_added", snapshot => {
      const data = snapshot.val();
      if (data.from === "DM") {
        terminal.innerHTML += `[DM] ${data.text}\n`;
        terminal.scrollTop = terminal.scrollHeight;
      }
    });
  </script>
</body>
</html>
